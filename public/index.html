<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>FFmpeg Form Builder</title>
    <!-- Choices.js CSS -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/choices.js/public/assets/styles/choices.min.css" />
    <style>
        :root { --primary: #4a90e2; --bg: #f5f7fa; --card: #ffffff; --text: #333; }
        body { font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif; background: var(--bg); color: var(--text); margin: 0; padding: 2rem; }
        .container { max-width: 900px; margin: 0 auto; }
        h1 { text-align: center; margin-bottom: 2rem; color: var(--primary); }
        
        .card { background: var(--card); padding: 2rem; border-radius: 12px; box-shadow: 0 4px 6px rgba(0,0,0,0.05); margin-bottom: 2rem; }
        .section-title { font-size: 1.2rem; font-weight: 600; margin-bottom: 1rem; border-bottom: 2px solid #eee; padding-bottom: 0.5rem; }
        
        .form-group { margin-bottom: 1.5rem; }
        label { display: block; margin-bottom: 0.5rem; font-weight: 500; }
        input[type="text"], input[type="number"], select { width: 100%; padding: 0.8rem; border: 1px solid #ddd; border-radius: 6px; font-size: 1rem; box-sizing: border-box; }
        
        .row { display: flex; gap: 1rem; }
        .col { flex: 1; }
        
        .toggle-group { display: flex; align-items: center; gap: 0.5rem; }
        
        button.primary { background: var(--primary); color: white; border: none; padding: 1rem 2rem; border-radius: 6px; font-size: 1.1rem; cursor: pointer; width: 100%; transition: background 0.2s; }
        button.primary:hover { background: #357abd; }
        
        .results { margin-top: 2rem; }
        .result-item { background: #eef2f7; padding: 1rem; border-radius: 6px; margin-bottom: 0.5rem; display: flex; justify-content: space-between; align-items: center; }
        .result-item a { color: var(--primary); text-decoration: none; font-weight: bold; }
        
        /* Choices.js overrides */
        .choices__inner { background-color: white; border-radius: 6px; }

        /* Library Styles */
        .library-list { list-style: none; padding: 0; margin: 0; }
        .library-item { display: flex; justify-content: space-between; align-items: center; padding: 0.8rem; border-bottom: 1px solid #eee; }
        .library-item:last-child { border-bottom: none; }
        .library-item span { font-weight: 500; }
        .btn-delete { background: #dc3545; color: white; border: none; padding: 0.4rem 0.8rem; border-radius: 4px; cursor: pointer; font-size: 0.9rem; }
        .btn-delete:hover { background: #c82333; }
        .empty-library { text-align: center; color: #888; padding: 1rem; font-style: italic; }

        /* Tab Styles */
        .tabs { display: flex; border-bottom: 1px solid #ddd; margin-bottom: 1rem; }
        .tab-btn { padding: 0.8rem 1.5rem; border: none; background: none; cursor: pointer; font-size: 1rem; color: #666; border-bottom: 2px solid transparent; }
        .tab-btn.active { color: var(--primary); border-bottom-color: var(--primary); font-weight: 600; }
        .tab-content { display: none; }
        .tab-content.active { display: block; }
    </style>
</head>
<body>

<div class="container">
    <h1>FFmpeg Form Builder</h1>

    <!-- API Key Section -->
    <div class="card" style="border-left: 5px solid #ffc107;">
        <div class="section-title">Authentication</div>
        <div class="form-group">
            <label>API Key</label>
            <input type="password" id="apiKeyInput" placeholder="Enter your API Key" onchange="saveApiKey()">
            <small style="color: #666;">Required for all operations.</small>
        </div>
    </div>

    <!-- Upload/Add Section -->
    <div class="card">
        <div class="section-title">1. Add Media (Videos & Audio)</div>
        
        <div class="tabs">
            <button class="tab-btn active" onclick="switchTab('upload')">Upload Files</button>
            <button class="tab-btn" onclick="switchTab('url')">External URL</button>
        </div>

        <div id="tab-upload" class="tab-content active">
            <div class="row">
                <input type="file" id="fileInput" accept="video/*,audio/*" multiple>
                <button onclick="uploadFiles()" style="width: auto; padding: 0 2rem; background: #28a745; color: white; border: none; border-radius: 6px; cursor: pointer;">Upload</button>
            </div>
            <div id="uploadStatus" style="margin-top: 0.5rem; color: #666;"></div>
        </div>

        <div id="tab-url" class="tab-content">
            <div class="row">
                <input type="text" id="urlInput" placeholder="https://example.com/media.mp4 or .mp3">
                <button onclick="addExternalUrl()" style="width: auto; padding: 0 2rem; background: var(--primary); color: white; border: none; border-radius: 6px; cursor: pointer;">Add URL</button>
            </div>
            <small style="color: #666;">Enter a direct link to a video or audio file.</small>
        </div>
    </div>

    <!-- Library Section -->
    <div class="card">
        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1rem;">
            <div class="section-title" style="margin-bottom: 0;">Media Library</div>
            <button onclick="bulkDeleteMedia()" style="background: #dc3545; color: white; border: none; padding: 0.4rem 0.8rem; border-radius: 4px; cursor: pointer; font-size: 0.8rem;">Delete All Files</button>
        </div>
        <div id="libraryContainer">
            <ul id="libraryList" class="library-list">
                <!-- Items will be loaded here -->
            </ul>
        </div>
        <button onclick="loadLibrary()" style="margin-top: 1rem; background: #6c757d; color: white; border: none; padding: 0.5rem 1rem; border-radius: 4px; cursor: pointer; font-size: 0.9rem;">Refresh Library</button>
    </div>

    <!-- Builder Section -->
    <div class="card">
        <div class="section-title">2. Build Your Request</div>
        
        <!-- Video Selection -->
        <div class="form-group">
            <label>Select Videos</label>
            <select id="videoSelect" multiple></select>
            <small style="color: #666;">Select one or more videos to process.</small>
        </div>

        <!-- Operation Mode -->
        <div class="form-group">
            <label>Operation Mode</label>
            <div class="toggle-group">
                <input type="radio" name="mode" id="modeBatch" value="batch" checked onchange="toggleMode()">
                <label for="modeBatch" style="margin:0; font-weight: normal;">Process Individually (Batch)</label>
                
                <input type="radio" name="mode" id="modeStitch" value="stitch" onchange="toggleMode()" style="margin-left: 1rem;">
                <label for="modeStitch" style="margin:0; font-weight: normal;">Stitch Together (Merge)</label>
            </div>
        </div>

        <!-- Settings -->
        <div class="row">
            <div class="col">
                <div class="form-group">
                    <label>Speed (Multiplier)</label>
                    <input type="number" id="settingSpeed" placeholder="1.0" step="0.1" min="0.1" max="10">
                </div>
            </div>
            <div class="col">
                <div class="form-group">
                    <label>Output Format</label>
                    <select id="settingFormat">
                        <option value="mp4">MP4</option>
                        <option value="mp3">MP3 (Audio Only)</option>
                        <option value="mov">MOV</option>
                        <option value="avi">AVI</option>
                        <option value="gif">GIF</option>
                    </select>
                </div>
            </div>
        </div>

        <div class="row">
            <div class="col">
                <div class="form-group">
                    <label>Target Resolution</label>
                    <select id="settingResolution">
                        <option value="original">Original (No Resize)</option>
                        <option value="1280:720">1280x720 (Landscape)</option>
                        <option value="1920:1080">1920x1080 (Full HD)</option>
                        <option value="1080:1920">1080x1920 (Portrait/TikTok)</option>
                        <option value="1080:1080">1080x1080 (Square)</option>
                    </select>
                </div>
            </div>
            <div class="col">
                <div class="form-group">
                    <label>Resize Mode</label>
                    <select id="settingResizeMode">
                        <option value="contain">Fit (Add Black Bars)</option>
                        <option value="cover">Fill (Smart Crop)</option>
                        <option value="stretch">Stretch (Distort)</option>
                    </select>
                </div>
            </div>
        </div>

        <div class="form-group">
            <div class="toggle-group">
                <input type="checkbox" id="settingMute">
                <label for="settingMute" style="margin:0;">Mute Audio</label>
            </div>
        </div>

        <div class="form-group">
            <label>Custom Audio Track (Optional)</label>
            <div style="display: flex; gap: 10px; align-items: center;">
                <select id="settingAudioUrl" style="flex: 1;">
                    <option value="">-- Select from Library --</option>
                </select>
                <span>OR</span>
                <input type="file" id="settingAudio" accept="audio/*" style="flex: 1;">
            </div>
            <small style="color: #666;">Will replace original audio. Loops if shorter than video.</small>
        </div>

        <div class="form-group" style="display: flex; gap: 1rem;">
            <div style="flex: 1;">
                <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:5px;">
                    <label style="margin:0;">Audio Volume</label>
                    <span id="volumeDisplay" style="font-size:0.9em; color:#666;">100%</span>
                </div>
                <input type="range" id="settingVolume" min="0" max="2" step="0.01" value="1" style="width:100%;" oninput="document.getElementById('volumeDisplay').innerText = Math.round(this.value * 100) + '%'">
            </div>
            <div style="flex: 1;">
                <label>Fade In (sec)</label>
                <input type="number" id="settingFadeIn" step="0.5" value="0" min="0">
            </div>
            <div style="flex: 1;">
                <label>Fade Out (sec)</label>
                <input type="number" id="settingFadeOut" step="0.5" value="0" min="0">
            </div>
        </div>

        <div class="form-group">
            <label>Custom Video Filters (Optional)</label>
            <input type="text" id="settingVFilters" placeholder="e.g. scale=1280:720, transpose=1">
        </div>

        <button class="primary" onclick="processRequest()">Run Process</button>
    </div>

    <!-- Results Section -->
    <div class="results" id="resultsArea"></div>
</div>

<!-- Choices.js Script -->
<script src="https://cdn.jsdelivr.net/npm/choices.js/public/assets/scripts/choices.min.js"></script>

<script>
    // Configuration: Set this to your production URL if running locally
    // If running on the same server, you can leave it empty or use window.location.origin
    const API_BASE_URL = 'https://video.andre-ia.fr'; 
    
    let videoChoices;
    let externalUrls = [];

    function switchTab(tab) {
        document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));
        document.querySelectorAll('.tab-content').forEach(c => c.classList.remove('active'));
        
        // Find button that triggered this
        const buttons = document.querySelectorAll('.tab-btn');
        if (tab === 'upload') buttons[0].classList.add('active');
        else buttons[1].classList.add('active');

        document.getElementById(`tab-${tab}`).classList.add('active');
    }

    function addExternalUrl() {
        const input = document.getElementById('urlInput');
        const url = input.value.trim();
        
        if (!url) return alert('Please enter a URL');
        if (!url.startsWith('http')) return alert('URL must start with http:// or https://');
        
        if (!externalUrls.includes(url)) {
            externalUrls.push(url);
            loadVideos(); // Refresh dropdown
            loadLibrary(); // Refresh list
            input.value = '';
            alert('URL added to library!');
        } else {
            alert('URL already exists in library');
        }
    }

    function removeExternalUrl(url) {
        externalUrls = externalUrls.filter(u => u !== url);
        loadVideos();
        loadLibrary();
    }

    // Initialize Choices.js
    document.addEventListener('DOMContentLoaded', () => {
        // Load API Key
        const savedKey = localStorage.getItem('ffmpeg_api_key');
        if (savedKey) document.getElementById('apiKeyInput').value = savedKey;

        const element = document.getElementById('videoSelect');
        videoChoices = new Choices(element, {
            removeItemButton: true,
            placeholder: true,
            placeholderValue: 'Search and select videos...',
            searchPlaceholderValue: 'Type to search...',
        });
        loadVideos();
        loadLibrary();
    });

    function saveApiKey() {
        const key = document.getElementById('apiKeyInput').value;
        localStorage.setItem('ffmpeg_api_key', key);
        loadVideos(); // Reload with new key
        loadLibrary();
    }

    function getHeaders() {
        const key = document.getElementById('apiKeyInput').value;
        return {
            'ffmpeg-apikey': key
        };
    }

    async function loadVideos() {
        try {
            const res = await fetch(`${API_BASE_URL}/api/videos`, { headers: getHeaders() });
            
            let files = [];
            if (res.ok) {
                files = await res.json();
            } else {
                if (res.status === 401) console.warn('Unauthorized: Please check your API Key.');
                else console.warn(`Server Error (${res.status})`);
            }

            const audioExtensions = ['.mp3', '.wav', '.m4a', '.aac', '.ogg', '.flac', '.m4p', '.wma', '.mp2', '.amr'];
            const videoExtensions = ['.mp4', '.mov', '.avi', '.mkv', '.webm', '.flv', '.m4v'];
            
            const isAudio = (filename) => audioExtensions.some(ext => filename.toLowerCase().endsWith(ext));
            const isVideo = (filename) => videoExtensions.some(ext => filename.toLowerCase().endsWith(ext));

            const serverChoices = files.map(file => ({
                value: file.filename,
                label: file.filename + (file.type === 'processed' ? ' (Processed)' : ''),
                selected: false,
                isAudio: isAudio(file.filename),
                isVideo: isVideo(file.filename)
            }));

            const urlChoices = externalUrls.map(url => ({
                value: url,
                label: url + ' (External URL)',
                selected: false,
                isAudio: isAudio(url),
                isVideo: isVideo(url)
            }));
            
            // Filter videos for the main dropdown
            const videoOnlyChoices = [...serverChoices, ...urlChoices].filter(c => c.isVideo || (!c.isAudio && !c.isVideo));
            videoChoices.setChoices(videoOnlyChoices, 'value', 'label', true);

            // Populate Audio Dropdown
            const audioSelect = document.getElementById('settingAudioUrl');
            const currentAudioValue = audioSelect.value;
            audioSelect.innerHTML = '<option value="">-- Select from Library --</option>';
            
            [...serverChoices, ...urlChoices].forEach(choice => {
                if (choice.isAudio) {
                    const opt = document.createElement('option');
                    opt.value = choice.value;
                    opt.textContent = choice.label;
                    if (choice.value === currentAudioValue) opt.selected = true;
                    audioSelect.appendChild(opt);
                }
            });
        } catch (e) {
            console.error('Failed to load videos', e);
        }
    }

    async function loadLibrary() {
        try {
            const res = await fetch(`${API_BASE_URL}/api/videos`, { headers: getHeaders() });
            let files = [];
            
            if (res.ok) {
                files = await res.json();
            }

            const list = document.getElementById('libraryList');
            list.innerHTML = '';

            if (files.length === 0 && externalUrls.length === 0) {
                list.innerHTML = '<li class="empty-library">No files found. Upload some media!</li>';
                return;
            }

            // Render External URLs
            externalUrls.forEach(url => {
                const li = document.createElement('li');
                li.className = 'library-item';
                li.style.background = '#fff8e1'; // Highlight external
                li.innerHTML = `
                    <span title="${url}" style="max-width: 60%; overflow: hidden; text-overflow: ellipsis; white-space: nowrap;">${url} <small style="color:#999; font-size:0.8em">(External)</small></span>
                    <div>
                        <a href="${url}" target="_blank" style="margin-right: 10px; color: #4a90e2; text-decoration: none;">Preview</a>
                        <button class="btn-delete" onclick="removeExternalUrl('${url}')">Remove</button>
                    </div>
                `;
                list.appendChild(li);
            });

            // Render Server Files
            files.forEach(file => {
                const li = document.createElement('li');
                li.className = 'library-item';
                li.innerHTML = `
                    <span>${file.filename} <small style="color:#999; font-size:0.8em">(${file.type})</small></span>
                    <div>
                        <a href="${file.url}" target="_blank" style="margin-right: 10px; color: #4a90e2; text-decoration: none;">Preview</a>
                        <button class="btn-delete" onclick="deleteVideo('${file.filename}')">Delete</button>
                    </div>
                `;
                list.appendChild(li);
            });
        } catch (e) {
            console.error('Failed to load library', e);
            document.getElementById('libraryList').innerHTML = '<li class="empty-library" style="color:red">Error loading library</li>';
        }
    }

    async function deleteVideo(filename) {
        if (!confirm(`Are you sure you want to delete "${filename}"?`)) return;

        try {
            const res = await fetch(`${API_BASE_URL}/api/videos/${filename}`, { 
                method: 'DELETE',
                headers: getHeaders()
            });
            const data = await res.json();
            
            if (data.success) {
                // Refresh both library and dropdown
                loadLibrary();
                loadVideos();
            } else {
                alert('Failed to delete: ' + data.error);
            }
        } catch (e) {
            console.error('Delete failed', e);
            alert('Error deleting file');
        }
    }

    async function bulkDeleteMedia() {
        if (!confirm('Are you sure you want to delete ALL uploaded and processed media files? This cannot be undone.')) return;

        try {
            const res = await fetch(`${API_BASE_URL}/api/bulk-delete-media`, { 
                method: 'POST',
                headers: getHeaders()
            });
            
            if (!res.ok) {
                const text = await res.text();
                throw new Error(`Server error (${res.status}): ${text.slice(0, 100)}`);
            }

            const data = await res.json();
            
            if (data.success) {
                alert('All media files deleted successfully');
                loadLibrary();
                loadVideos();
            } else {
                alert('Failed to delete files: ' + data.error);
            }
        } catch (e) {
            console.error('Bulk delete failed', e);
            alert('Error performing bulk delete');
        }
    }

    async function uploadFiles() {
        const input = document.getElementById('fileInput');
        const status = document.getElementById('uploadStatus');
        
        if (input.files.length === 0) return alert('Select files first');

        status.innerText = 'Uploading...';
        
        for (let file of input.files) {
            const formData = new FormData();
            const audioExtensions = ['.mp3', '.wav', '.m4a', '.aac', '.ogg', '.flac', '.m4p', '.wma', '.mp2', '.amr'];
            const isAudioExt = audioExtensions.some(ext => file.name.toLowerCase().endsWith(ext));
            const fieldName = (file.type.startsWith('audio/') || isAudioExt) ? 'audio' : 'video';
            formData.append(fieldName, file);
            await fetch(`${API_BASE_URL}/api/upload`, { 
                method: 'POST', 
                body: formData,
                headers: getHeaders()
            });
        }
        
        status.innerText = 'Upload complete!';
        input.value = '';
        loadVideos(); // Refresh list
        loadLibrary(); // Refresh library
    }

    function toggleMode() {
        const isStitch = document.getElementById('modeStitch').checked;
        // Logic to show/hide specific fields if needed
    }

    async function processRequest() {
        const selectedVideos = videoChoices.getValue(true); // Get array of values
        if (!selectedVideos || selectedVideos.length === 0) return alert('Please select at least one video.');

        const mode = document.querySelector('input[name="mode"]:checked').value;
        const speed = document.getElementById('settingSpeed').value;
        const format = document.getElementById('settingFormat').value;
        const mute = document.getElementById('settingMute').checked;
        const vFilters = document.getElementById('settingVFilters').value;
        const volume = document.getElementById('settingVolume').value;
        const fadeIn = document.getElementById('settingFadeIn').value;
        const fadeOut = document.getElementById('settingFadeOut').value;
        const resolution = document.getElementById('settingResolution').value;
        const resizeMode = document.getElementById('settingResizeMode').value;
        const customAudioUrl = document.getElementById('settingAudioUrl').value;

        const resultsArea = document.getElementById('resultsArea');
        resultsArea.innerHTML = '<div style="text-align:center; color:#666;">Processing... please wait.</div>';

        try {
            if (mode === 'stitch') {
                if (selectedVideos.length < 2) return alert('Stitching requires at least 2 videos.');
                await runStitchPipeline(selectedVideos, { speed, format, mute, vFilters, volume, fadeIn, fadeOut, resolution, resizeMode, customAudioUrl });
            } else {
                await runBatchPipeline(selectedVideos, { speed, format, mute, vFilters, volume, fadeIn, fadeOut, resolution, resizeMode, customAudioUrl });
            }
        } catch (e) {
            resultsArea.innerHTML = `<div style="color:red; text-align:center;">Error: ${e.message}</div>`;
        }
    }

    async function runStitchPipeline(videos, settings) {
        // Step 1: Stitch
        addResultLog('Stitching videos...');
        const stitchPayload = { 
            videos, 
            mute: false,
            resolution: settings.resolution,
            resizeMode: settings.resizeMode,
            customAudioUrl: settings.customAudioUrl
        };
        addResultJson(stitchPayload, 'View Request Payload (Stitch)');
        
        const stitchRes = await fetch(`${API_BASE_URL}/api/stitch`, {
            method: 'POST',
            headers: { 
                'Content-Type': 'application/json',
                ...getHeaders()
            },
            body: JSON.stringify(stitchPayload) // We handle mute in step 2
        });
        const stitchData = await stitchRes.json();
        addResultJson(stitchData, 'View Response (Stitch)');
        if (!stitchData.success) throw new Error(stitchData.error);

        // Step 2: Apply Transforms (Speed, Mute, Format)
        // The stitch API returns a url like /processed/filename.mp4
        // We need the filename to pass to /api/custom
        const stitchedFilename = stitchData.url.split('/').pop();
        
        addResultLog('Applying settings to stitched video...');
        await runCustomTransform(stitchedFilename, settings, 'Final Stitched Video');
    }

    async function runBatchPipeline(videos, settings) {
        document.getElementById('resultsArea').innerHTML = ''; // Clear
        for (const video of videos) {
            addResultLog(`Processing ${video}...`);
            await runCustomTransform(video, settings, `Result: ${video}`);
        }
    }

    async function runCustomTransform(filename, settings, label) {
        const formData = new FormData();
        formData.append('filename', filename);
        if (settings.format) formData.append('format', settings.format);
        if (settings.speed) formData.append('speed', settings.speed);
        if (settings.mute) formData.append('mute', settings.mute);
        if (settings.vFilters) formData.append('videoFilters', settings.vFilters);
        if (settings.volume) formData.append('volume', settings.volume);
        if (settings.fadeIn) formData.append('fadeIn', settings.fadeIn);
        if (settings.fadeOut) formData.append('fadeOut', settings.fadeOut);
        if (settings.resolution) formData.append('resolution', settings.resolution);
        if (settings.resizeMode) formData.append('resizeMode', settings.resizeMode);
        if (settings.customAudioUrl) formData.append('customAudioUrl', settings.customAudioUrl);
        
        // Add custom audio file if present
        const audioInput = document.getElementById('settingAudio');
        if (audioInput.files.length > 0) {
            formData.append('customAudio', audioInput.files[0]);
        }

        // Log the request payload (convert FormData to object for display)
        const requestLog = {};
        formData.forEach((value, key) => {
            if (value instanceof File) {
                requestLog[key] = `File: ${value.name} (${value.size} bytes)`;
            } else {
                requestLog[key] = value;
            }
        });
        addResultJson(requestLog, 'View Request Payload (Custom)');

        const res = await fetch(`${API_BASE_URL}/api/custom`, {
            method: 'POST',
            body: formData,
            headers: getHeaders()
        });
        const data = await res.json();
        addResultJson(data, 'View Response (Custom)');
        
        if (data.success) {
            // Ensure download URL is absolute if needed, or just use what server returns
            // If server returns relative path, prepend API_BASE_URL
            const downloadUrl = data.url.startsWith('http') ? data.url : `${API_BASE_URL}${data.url}`;
            addResultLink(label, downloadUrl);
        } else {
            addResultLog(`Failed: ${data.error}`);
        }
    }

    function addResultJson(data, title = 'View JSON Response') {
        const details = document.createElement('details');
        const summary = document.createElement('summary');
        summary.innerText = title;
        summary.style.cursor = 'pointer';
        summary.style.color = '#007bff';
        summary.style.marginBottom = '5px';
        
        const pre = document.createElement('pre');
        pre.style.background = '#f4f4f4';
        pre.style.padding = '10px';
        pre.style.fontSize = '12px';
        pre.style.overflowX = 'auto';
        pre.style.border = '1px solid #ddd';
        pre.innerText = JSON.stringify(data, null, 2);
        
        details.appendChild(summary);
        details.appendChild(pre);
        document.getElementById('resultsArea').appendChild(details);
    }

    function addResultLog(text) {
        const div = document.createElement('div');
        div.style.padding = '0.5rem';
        div.style.color = '#666';
        div.innerText = text;
        document.getElementById('resultsArea').appendChild(div);
    }

    function addResultLink(label, url) {
        const div = document.createElement('div');
        div.className = 'result-item';
        div.innerHTML = `
            <span>${label}</span>
            <a href="${url}" target="_blank" download>Download</a>
        `;
        document.getElementById('resultsArea').appendChild(div);
    }
</script>

</body>
</html>
